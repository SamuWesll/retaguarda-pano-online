
<section class="flex-column col-12">
    <header class="d-flex justify-content-between col-12">
        <h1>Pedidos</h1>
        <div>
            <h3>Pano Online</h3>
        </div>
    </header>

    <div class="col-12 flex-column">

        <div class="mt-1 col-12 d-flex">
            <label class="mt-1 mr-3">Pesquisar pedido: </label>

            <div class="input-group col-3">
                <input type="text" class="form-control" (keyup)="pesquisar(textoPesquisa.value)" ng-model="pesquisaInput" #textoPesquisa placeholder="id do pedido" aria-label="Recipient's username" aria-describedby="button-addon2">
                <div class="input-group-append">
                    <button class="btn btn-dark" type="button" id="pesquisa">
                        <img src="../../../assets/img/search.png" height="18px" alt="">
                    </button>
                </div>
            </div>

            <div id="data" class="col-6 d-flex">
                <form #formm class="form-inline">
                    <div class="form-group hidden">
                      <div class="input-group">
                        <input name="datepicker"
                               class="form-control"
                               ngbDatepicker
                               #datepicker="ngbDatepicker"
                               [autoClose]="'outside'"
                               (dateSelect)="onDateSelection($event)"
                               [displayMonths]="2"
                               [dayTemplate]="t"
                               outsideDays="hidden"
                               [startDate]="fromDate!">
                        <ng-template #t let-date let-focused="focused">
                          <span class="custom-day"
                                [class.focused]="focused"
                                [class.range]="isRange(date)"
                                [class.faded]="isHovered(date) || isInside(date)"
                                (mouseenter)="hoveredDate = date"
                                (mouseleave)="hoveredDate = null">
                            {{ date.day }}
                          </span>
                        </ng-template>
                      </div>
                    </div>
                    <div class="form-group">
                      <div class="input-group">
                        <input #dpFromDate
                               class="form-control" placeholder="yyyy-mm-dd"
                               name="dpFromDate"
                               [value]="formatter.format(fromDate)"
                               (input)="fromDate = validateInput(fromDate, dpFromDate.value)"
                               ng-blur="retorno()">
                        <div class="input-group-append">
                          <button class="btn btn-dark" (click)="datepicker.toggle()" type="button">
                            <fa-icon [icon]="faCalendar" size="sm"></fa-icon>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="form-group ml-2">
                      <div class="input-group">
                        <input #dpToDate
                               class="form-control" placeholder="yyyy-mm-dd"
                               name="dpToDate"
                               [value]="formatter.format(toDate)"
                               (input)="toDate = validateInput(toDate, dpToDate.value)">
                        <div class="input-group-append">
                          <button class="btn btn-dark" (click)="datepicker.toggle()" type="button">
                            <fa-icon [icon]="faCalendar" size="sm"></fa-icon>
                          </button>
                        </div>
                      </div>
                    </div>
                </form>      
            </div>

        </div>

        <div class="col-12 d-flex">
            <div class="col-6 flex-column mt-3">
                <h5>Lista de pedidos: </h5>
                <table class="col-12 mt-4 flex-column justify-content-between mb-5">
                    <tr id="titulo" class="text-center">
                        <th>id</th>
                        <th>status</th>
                        <th>data</th>
                        <th>editar</th>
                    </tr>
                    <tbody id="pedidoL">
                        <tr scope="row" *ngFor="let pedido of listaPedidos index as i" (click)="selecionandoPedido(pedido)">
                        <!-- <tr scope="row" *ngFor="let pedido of listaPedidos | slice: 0:14; index as i" (click)="selecionandoPedido(pedido)"> -->
                            <th class="text-center" >{{ pedido.idPedido }}</th>
                            <th class="text-center" [class.cancelado]="pedido.status == 'Cancelado' " >{{ pedido.status }}</th>
                            <th class="text-center" >{{ formatarData(pedido.dataPedido) }}</th>
                            <div class="d-flex justify-content-center" *ngIf="pedido.status == 'Cancelado'">
                                <th class="col-12 text-center status">{{ acaoStatus(pedido.status) }}</th>
                            </div>
                            <div class="d-flex justify-content-center" *ngIf="pedido.status == 'Aguardando confirmação de pagamento'">
                                <th class="col-12 text-center status" (click)="modalLiberarPagamento.show()">{{ acaoStatus(pedido.status) }}</th>
                            </div>
                            <div class="d-flex justify-content-center" *ngIf="pedido.status == 'Pagamento confirmado'">
                                <th class="col-12 text-center status" (click)="modalLiberSeparacao.show()">{{ acaoStatus(pedido.status) }}</th>
                            </div>
                            <div class="d-flex justify-content-center" *ngIf="pedido.status == 'Produto em separação'">
                                <th class="col-12 text-center status">{{ acaoStatus(pedido.status) }}</th>
                            </div>
                            
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="detalhePedido" class="col-6">
                <h5 class="mt-4">Detalhe do pedido: </h5>
                <!-- <div *ngIf="pedidoSelecionado.selecionado"> -->
                <div>
                    <ngb-accordion class="mt-2" [closeOthers]="true" activeIds="static-1">
                        <ngb-panel id="static-1" title="Pedido">
                            <ng-template ngbPanelContent *ngIf="!pedidoSelecionado['selecionado']">
                                <h5>Selecione um pedido</h5>
                            </ng-template>
                            <ng-template ngbPanelContent *ngIf="pedidoSelecionado['selecionado']">
                                <div>
                                    <p><strong>id pedido: </strong>{{ pedidoSelecionado['pedido'][0].idPedido }}</p>
                                    <p><strong>forma de pagamento: </strong>{{ pedidoSelecionado['pedido'][0].formaPgto }}</p>
                                    <p><strong>status do pedido: </strong>{{ pedidoSelecionado['pedido'][0].status }}</p>
                                    <div class="d-flex justify-content-between">
                                        <p><strong>Valor Frete: </strong>{{ mascaraValor(pedidoSelecionado['pedido'][0].valorFrete) }}</p>
                                        <p><strong>Valor Produtos: </strong>{{ mascaraValor(pedidoSelecionado['pedido'][0].totalCompra) }}</p>
                                        <p><strong>Valor Total: </strong>{{ mascaraValor(pedidoSelecionado['pedido'][0].totalCompra + pedidoSelecionado['pedido'][0].valorFrete) }}</p>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <p><strong>Cliente: </strong>{{ cliente['nome'] }}</p>
                                        <p><strong>Nr. CPF: </strong>{{ cliente['cpf'] }}</p>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <p><strong>Email: </strong>{{ cliente['email'] }}</p>
                                        <p><strong>Idade: </strong>{{ calcularIdade(cliente['dataNascimento']) }} anos</p>
                                    </div>
                                </div>
                            </ng-template>
                        </ngb-panel>

                        <ngb-panel id="static-2">
                            <ng-template ngbPanelTitle>
                            <span (click)="capturaEndereco()">Endereço</span>
                            </ng-template>
                            <ng-template ngbPanelContent>
                                <div>
                                    <p><strong>CEP: </strong>{{ endereco['cep'] }}</p>
                                    <div class="d-flex justify-content-between">
                                        <p><strong>Logradouro: </strong>{{ endereco['logradouro'] }}</p>
                                        <p><strong>Numero: </strong>{{ endereco['numero'] }}</p>
                                    </div>
                                    <p><strong>Complemento: </strong>{{ endereco.complemento }}</p>
                                    <div class="d-flex justify-content-between">
                                        <p><strong>Bairro: </strong>{{ endereco.bairro }}</p>
                                        <p><strong>Cidade/UF: </strong>{{ endereco.cidade }}/{{ endereco.uf }}</p>
                                    </div>
                                </div>
                            </ng-template>
                        </ngb-panel>

                        <ngb-panel id="static-3">
                            <ng-template ngbPanelTitle>
                            <span (click)="detalheProduto()">Produtos</span>
                            </ng-template>
                            <ng-template ngbPanelContent>
                                <table class="col-12 mt-1 flex-column justify-content-between">
                                    <tr class="text-center">
                                        <th>id</th>
                                        <th>img</th>
                                        <th>produto</th>
                                        <th>categoria</th>
                                        <th>quantidade</th>
                                        <th>Vl.</th>
                                    </tr>
                                    <tbody>
                                        <!-- <tr class="mt-2"> -->
                                        <tr class="mt-2" scope="row" *ngFor="let item of pedidoSelecionado['pedido'][0].itensPedido | slice: 0:15; index as i">
                                            <th class="text-center">{{ item['idItensPedido'] }}</th>
                                            <th class="d-flex justify-content-center">
                                                <img src="{{ item.imagem }}" height="60px" alt="">
                                            </th>
                                            <th class="text-center">{{ item.tituloProduto }}</th>
                                            <th class="text-center">{{ getNomeDaCategoria(item.categoria) }}</th>
                                            <th class="text-center">{{ item.qtdProduto }}</th>
                                            <th class="text-center">{{ mascaraValor(item.valorProduto) }}</th>
                                        </tr>
                                </table>
                            </ng-template>
                        </ngb-panel>

                    </ngb-accordion>
                </div>
            </div>

        </div>

    </div>

</section>

<!-- inicio - Modal (status-Aguardando confirmação de pagamento -->
<div
  mdbModal
  #modalLiberarPagamento="mdbModal"
  class="modal fade top"
  id="frameModalTop"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
  style="overflow-y: auto"
>
    <div class="modal-dialog modal-notify modal-danger" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title text-white w-100">Confirmar pagamento</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modalLiberarPagamento.hide()">
                    <span aria-hidden="true" class="white-text">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="md-form d-flex justify-content-center text-center">
                    <h5>Realmente deseja avança o pedido para pagamento aprovado?</h5>
                </div>
                
                <div class="d-flex justify-content-center mt-4">
                    <button type="submit" class="btn btn-outline-success rounded mr-2" id="btnEnviarEmail" (click)="putStatus('Pagamento confirmado')">Confirmar</button>
                    <button type="submit" class="btn btn-outline-warning rounded mr-2 ml-2" id="btnEnviarEmail" (click)="putStatus('Cancelado')">Cancelar Pedido</button>
                    <button type="button" class="btn btn-outline-danger rounded ml-2" (click)="modalLiberarPagamento.hide()">Voltar</button>
                </div>
                
            </div>
        </div>
        
    </div>
</div>

<!-- fim - Modal (status-Aguardando confirmação de pagamento -->

<!-- inicio - Modal (status-Pagamento Confirmado -->
<div
  mdbModal
  #modalLiberSeparacao="mdbModal"
  class="modal fade top"
  id="frameModalTop"
  tabindex="-1"
  role="dialog"
  aria-labelledby="myModalLabel"
  aria-hidden="true"
  style="overflow-y: auto"
>
    <div class="modal-dialog modal-notify modal-danger" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title text-white w-100">Disponibilizar para separação</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="modalLiberSeparacao.hide()">
                    <span aria-hidden="true" class="white-text">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="md-form d-flex justify-content-center text-center">
                    <h5>Realmente deseja enviar o pedido para separação de mercadoria?</h5>
                </div>
                
                <div class="d-flex justify-content-center mt-4">
                    <button type="submit" class="btn btn-outline-success rounded mr-2" id="btnEnviarEmail" (click)="putStatus('Produto em separação')">Confirmar</button>
                    <button type="submit" class="btn btn-outline-warning rounded mr-2 ml-2" id="btnEnviarEmail" (click)="putStatus('Cancelado')">Cancelar Pedido</button>
                    <button type="button" class="btn btn-outline-danger rounded ml-2" (click)="modalLiberSeparacao.hide()">Voltar</button>
                </div>
                
            </div>
        </div>
        
    </div>
</div>

<!-- fim - Modal (status-Pagamento Confirmado -->